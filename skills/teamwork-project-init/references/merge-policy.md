# 规则文件最小差异合并策略（AGENTS.md）

目标：在不破坏项目已有习惯的前提下，补齐必须的流程门禁与目录规范，让规则文件可用、可维护、可演进。

## 总体原则

- 不“推倒重写”：优先保留项目现有内容、顺序与措辞
- 只补缺口：缺什么补什么，不随意改已有规则
- 以可执行为准：保证流程门禁与文档路径一致
- 单一标准：只保留 AGENTS.md

## 合并完成后的验收

- 合并完成后按 references/init-acceptance-checklist.md 自检

## 需要保证存在的最小块

如果规则文件缺失以下任一块，则新增；若已存在但语义冲突，则提示并提出合并建议：

1) 目录约定（references/docs/source）
2) 阶段顺序（需求→设计→开发→测试→部署）
3) 默认工作流（含文档路径与“先文档后代码”）
4) 双重确认机制（自检 + 用户确认）
5) 角色职责（最小集合）
6) 样式规范（默认 TailwindCSS；项目已有则遵循项目）
7) 环境与配置（密钥不入库，.env.example 约定）
8) 启动与运行（可复现的安装与启动方式）
9) 测试与质量门禁（测试/lint/typecheck 或等价验证）

## 合并规则（从安全到激进）

1) 文件选择
- 如果存在 AGENTS.md：以 AGENTS.md 为主
- 如果都不存在：从 assets/AGENTS.md 生成

2) 合并方式
- 先识别已有一级标题（`#`）与二级标题（`##`）
- 对每个“最小块”：
  - 若已有同名标题：只补缺失的小项（比如缺 `docs/release/RELEASE.md` 这一条）
  - 若无同名标题：追加一个新块（放在语义相近位置；找不到就放末尾）

3) 冲突处理
- 文档路径冲突：以项目现状为准，但必须统一在全文件中一致
- 门禁冲突（例如允许先改代码）：保留项目原文，同时新增一条“默认门禁”并提示风险
- 风格冲突（例如原本强制 UnoCSS）：保留项目原文，Tailwind 仅作为默认建议

4) 同步输出
- 完成合并后，只输出 AGENTS.md
